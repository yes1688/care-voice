---
plan_id: "plan_202508102330_realtime_transcription"
title: "即時語音轉錄系統實作"
date_created: "2025-08-10T23:30+08:00"
date_updated: "2025-08-10T23:30+08:00"
date_completed: ""
status: "in_progress"
priority: "high"
category: "development"
estimated_duration: "8-12 hours"
actual_duration: ""
tags: ["realtime", "websocket", "webcodecs", "whisper-ai", "gpu-acceleration"]
related_plans: ["WebCodecs OPUS 修復完成", "RTX 5070 Ti CUDA 修復"]
dependencies: ["WebCodecs 功能正常", "GPU 加速可用", "統一音頻端點"]
---

# 🎙️ 即時語音轉錄系統實作

## 📋 計劃概要
- **目標**: 實現「一邊錄音，一邊顯示文字」的即時語音轉錄功能
- **觸發原因**: 用戶明確需求，提升 Care Voice 的互動體驗到業界領先水準
- **預期完成時間**: 8-12 小時（分 3 個階段完成）

## 🎯 具體目標
1. [ ] 建立後端 WebSocket 音頻串流處理系統
2. [ ] 實作前端即時音頻傳送和文字顯示介面
3. [ ] 整合 Whisper AI 即時轉錄引擎
4. [ ] 優化音頻緩衝和 GPU 記憶體管理
5. [ ] 完成端到端測試和效能調校

## 📝 詳細步驟

### 階段一：後端 WebSocket 串流基礎架構
- [ ] 在 `backend/src/main.rs` 新增 WebSocket 路由 `/ws/transcribe`
- [ ] 實作 WebSocket 連線管理和音頻包接收
- [ ] 建立音頻緩衝佇列（每 1-2 秒批次處理）
- [ ] 整合現有 Whisper 模型池進行小段音頻轉錄
- [ ] 實作轉錄結果串流回傳機制

### 階段二：前端即時介面開發
- [ ] 修改 `frontend/src/App.tsx` 建立 WebSocket 連線
- [ ] 改造 WebCodecs 錄音，從累積模式改為串流模式
- [ ] 新增即時文字顯示區域組件
- [ ] 實作連線狀態、錄音狀態、網路狀態顯示
- [ ] 優化 UI/UX：即時文字更新、歷史記錄保留

### 階段三：效能最佳化和測試
- [ ] 音頻緩衝大小調校（平衡延遲與準確度）
- [ ] GPU 記憶體使用最佳化
- [ ] 網路中斷重連機制
- [ ] 錯誤處理和降級策略
- [ ] 完整的端到端功能測試

## 🏗️ 技術架構設計

### 資料流程
```
前端 WebCodecs → 即時 OPUS 包 → WebSocket → 音頻緩衝佇列 → Whisper AI (GPU) → 文字結果 → WebSocket → 前端顯示
```

### 關鍵技術決策
1. **通訊協定**: WebSocket（低延遲，瀏覽器原生支援）
2. **音頻格式**: 維持 OPUS 編碼（已經過最佳化）
3. **處理策略**: 1-2 秒音頻片段批次處理
4. **GPU 加速**: 充分利用 RTX 5070 Ti 的 Tensor Core
5. **前端框架**: 基於現有 SolidJS 架構擴展

### 音頻處理流程
- **緩衝管理**: 環形緩衝區避免記憶體洩漏
- **批次大小**: 1.5 秒音頻片段（平衡延遲與品質）
- **重疊處理**: 0.5 秒重疊確保語音連續性
- **即時顯示**: 逐字追加，保留完整轉錄歷史

## 🔄 執行記錄
**23:30** - 計劃建立，需求分析完成  
**23:31** - 技術架構設計確認，等待開始實作  

## 📊 結果評估
- **成功指標**: 
  - 錄音延遲 < 2 秒
  - 轉錄準確度保持現有水準
  - 系統穩定運行無記憶體洩漏
  - 網路中斷後能自動重連
- **實際結果**: [待實作完成後填寫]
- **經驗教訓**: [待實作完成後總結]

## 🔗 相關資源
- **相關檔案**: 
  - `backend/src/main.rs` (主要後端修改)
  - `frontend/src/App.tsx` (主要前端修改)
  - `backend/src/whisper_model_pool.rs` (模型池整合)
  - `nginx-production.conf` (可能需要 WebSocket 配置)
- **參考文檔**: 
  - [WebCodecs 修復完成摘要](../WEBCODECS_FIX_SUMMARY.md)
  - [RTX 5070 Ti CUDA 修復報告](../RTX_5070_TI_CUDA_FIX_ACHIEVEMENT.md)
  - [統一音頻端點文檔](../ARCHITECTURE.md)
- **後續計劃**: 
  - 行動裝置適配最佳化
  - 多語言即時轉錄支援
  - 離線模式開發

## 🚀 技術優勢
此實作將充分發揮 Care Voice 的技術優勢：
- **GPU 為生**: RTX 5070 Ti 提供即時轉錄算力
- **WebCodecs 領先**: 硬體加速音頻編碼
- **統一架構**: 無需複雜的微服務架構
- **業界領先**: 真正的即時語音轉錄體驗

## 📝 備註
- 此功能將使 Care Voice 從「錄音後轉錄」升級為「即時互動式轉錄」
- 充分利用現有的技術基礎，無需重大架構變更
- 實作完成後將成為 Care Voice 的核心競爞優勢功能